

# 安装filebeat

### 1. 下载和安装key文件

```shell
rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch
```

### 2. 创建yum源文件

```shell
[root@localhost ~]# vim /etc/yum.repos.d/elk-elasticsearch.repo
```

```shell
[elastic-6.x]
name=Elastic repository for 6.x packages
baseurl=https://artifacts.elastic.co/packages/6.x/yum
gpgcheck=1
gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch
enabled=1
autorefresh=1
type=rpm-md
```



### 3. 开始安装

```shell
yum install filebeat
```

### 4.配置文件

```shell
[root@localhost ~]# vim /etc/filebeat/filebeat.yml
```

配置filebeat监控文件，以及删除和重名名文件的时候是否关闭监控

```yaml
#=========================== Filebeat inputs =============================

filebeat.inputs:

# Each - is an input. Most options can be set at the input level, so
# you can use different inputs for various configurations.
# Below are the input specific configurations.

- type: log

  # Change to true to enable this input configuration.
  enabled: true

  # Paths that should be crawled and fetched. Glob based paths.
  paths:
    #- /var/log/*.log
    - /mnt/www/XXXXX/http-*.log #要监控的文件
    #- c:\programdata\elasticsearch\logs\*
  document_type: "log" # 定义写入 ES 时的 _type 值
  fields:
    logsource: web3
    logtype: user_action
  close_renamed: true
  clean_removed: true
  close_removed: true
```

可以配置输出到哪里，如Elasticsearch或者Logstash，下图是Logstash示例

```yaml
#----------------------------- Logstash output --------------------------------
#output.logstash:
  # The Logstash hosts
  #hosts: ["localhost:5044"]
output.logstash:
  hosts: ["XXX.XXX.XXX.XXX:5044"]
  worker: 2
  # Optional SSL. By default is off.
  # List of root certificates for HTTPS server verifications
  #ssl.certificate_authorities: ["/etc/pki/root/ca.pem"]

  # Certificate for SSL client authentication
  #ssl.certificate: "/etc/pki/client/cert.pem"

  # Client Certificate Key
  #ssl.key: "/etc/pki/client/cert.key"
```

可以设置一下忽略字段，例如：

```yaml
#================================ Processors =====================================
# Configure processors to enhance or manipulate events generated by the beat.
processors:
  - add_host_metadata: ~
  - add_cloud_metadata: ~
  - drop_fields:
     fields: ["beat.hostname", "beat.name", "beat.version", "beat"]
```

### 5.启动服务

```shell
systemctl start filebeat
```

或者

``shell
service filebeat start
```



文件上传记录：/var/lib/filebeat/registry